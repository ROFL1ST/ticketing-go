{
	"info": {
		"_postman_id": "49143173-0827929a-8ce5-444b-8114-9c843fdf65fc",
		"name": "Ticketing System API",
		"description": "Postman collection for Ticketing System",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Auth",
			"item": [
				{
					"name": "Register",
					"id": "49143173-8541639c-857f-4a55-a380-ee33c75f59a2",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Danendra2\",\n  \"email\": \"test2@mail.com\",\n  \"password\": \"123456\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/register",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"register"
							]
						}
					},
					"response": []
				},
				{
					"name": "login",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "bcfcc9a3-5d9d-491d-85e6-a5c7cbdf4566",
								"exec": [
									"// Visualization Script",
									"// Visualization Script",
									"// Tests + Visualization for login response",
									"// 1) Safely parse JSON",
									"let res = {};",
									"try {",
									"  res = pm.response.json();",
									"} catch (e) {",
									"  res = {};",
									"}",
									"",
									"// 2) Basic assertions",
									"pm.test(\"Status code is 200\", function () {",
									"  pm.response.to.have.status(200);",
									"});",
									"pm.test(\"Response success flag is true\", function () {",
									"  pm.expect(res && typeof res === 'object' && res.success).to.eql(true);",
									"});",
									"",
									"// 3) Normalize users array (support data.user or data.users)",
									"function normalizeUsers(payload) {",
									"  const data = payload && payload.data ? payload.data : {};",
									"  if (Array.isArray(data.users)) {",
									"    return data.users.filter(Boolean);",
									"  }",
									"  if (data && data.user) {",
									"    return [data.user];",
									"  }",
									"  return [];",
									"}",
									"",
									"const users = normalizeUsers(res);",
									"",
									"// 4) Compute role counts",
									"const roleCounts = users.reduce((acc, u) => {",
									"  const role = (u && typeof u.role === 'string' && u.role.trim()) ? u.role.trim() : 'unknown';",
									"  acc[role] = (acc[role] || 0) + 1;",
									"  return acc;",
									"}, {});",
									"",
									"// If no users array/object present, still show something meaningful",
									"const hasUserData = users.length > 0;",
									"if (!hasUserData) {",
									"  // Fall back to showing success flag as a single bar to avoid empty chart",
									"  roleCounts['no users in response'] = 1;",
									"}",
									"",
									"// 5) Prepare labels and values arrays",
									"const labels = Object.keys(roleCounts);",
									"const values = labels.map(k => roleCounts[k]);",
									"",
									"// 6) Visualization using Chart.js via pm.visualizer",
									"const template = `",
									"<div>",
									"  <h3>Role distribution</h3>",
									"  <p>{{#if hasUserData}}Based on {{userCount}} user(s) from response.{{else}}No users found in response; showing placeholder.{{/if}}</p>",
									"  <canvas id=\"roleChart\" height=\"90\"></canvas>",
									"</div>",
									"<script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js\"></script>",
									"<script>",
									"  var ctx = document.getElementById('roleChart');",
									"  var chart;",
									"  pm.getData(function (err, value) {",
									"    if (err) { return; }",
									"    var data = value || { labels: [], values: [] };",
									"    var bg = data.labels.map(function(_, i){ return 'rgba(54, 162, 235, 0.5)'; });",
									"    var border = data.labels.map(function(_, i){ return 'rgba(54, 162, 235, 1)'; });",
									"",
									"    chart = new Chart(ctx, {",
									"      type: 'bar',",
									"      data: {",
									"        labels: data.labels,",
									"        datasets: [{",
									"          label: 'Count',",
									"          data: data.values,",
									"          backgroundColor: bg,",
									"          borderColor: border,",
									"          borderWidth: 1",
									"        }]",
									"      },",
									"      options: {",
									"        responsive: true,",
									"        legend: { display: false },",
									"        title: { display: true, text: 'User Roles' },",
									"        scales: {",
									"          yAxes: [{",
									"            ticks: { beginAtZero: true, precision: 0 }",
									"          }],",
									"          xAxes: [{",
									"            ticks: { autoSkip: false }",
									"          }]",
									"        }",
									"      }",
									"    });",
									"  });",
									"</script>",
									"`;",
									"",
									"function createPayload() {",
									"  return {",
									"    labels: labels,",
									"    values: values,",
									"    hasUserData: hasUserData,",
									"    userCount: users.length",
									"  };",
									"}",
									"",
									"pm.visualizer.set(template, createPayload());"
								],
								"type": "text/javascript",
								"packages": {},
								"requests": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "b28a445f-67e1-48e1-b690-3b8eb33b3ed4",
								"exec": [],
								"type": "text/javascript"
							}
						}
					],
					"id": "49143173-e46d35bd-2ef9-4055-86df-a13f07b8b5a2",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"test2@mail.com\",\n  \"password\": \"123456\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"login"
							]
						}
					},
					"response": []
				}
			],
			"id": "49143173-6a46b29e-31d1-4278-8dd0-952c90020e68"
		},
		{
			"name": "User",
			"item": [
				{
					"name": "Get My Tickets",
					"id": "49143173-cf48a8bb-57b5-4dfb-ab41-4a7cdac95377",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/user/tickets",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"user",
								"tickets"
							]
						}
					},
					"response": []
				},
				{
					"name": "Create Ticket",
					"id": "49143173-dc145a31-39aa-495e-8125-b90827fde8bb",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"Tidak bisa login\",\n  \"message\": \"Aplikasi error ketika login\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/user/tickets",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"user",
								"tickets"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Ticket Detail",
					"id": "49143173-d5d662e7-a90b-434b-8fc7-d6c2242512ac",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/user/tickets/:id",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"user",
								"tickets",
								":id"
							],
							"variable": [
								{
									"key": "id",
									"value": "1"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Add Comment",
					"id": "49143173-5fe48aed-2856-4c29-9f56-acf262bae123",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"message\": \"Ada tambahan info error\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/user/tickets/:id/comment",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"user",
								"tickets",
								":id",
								"comment"
							],
							"variable": [
								{
									"key": "id",
									"value": "1"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "delete comment",
					"id": "49143173-74e07f14-1905-4b65-8080-ffd2459b6a9c",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/user/tickets/comment/:id",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"user",
								"tickets",
								"comment",
								":id"
							],
							"variable": [
								{
									"key": "id",
									"value": "1"
								}
							]
						}
					},
					"response": []
				}
			],
			"id": "49143173-72c9ebfd-b727-4ae7-8aba-5de769d6ff14"
		},
		{
			"name": "Admin",
			"item": [
				{
					"name": "Get All Tickets",
					"id": "49143173-c428bc98-c906-4a64-836a-862d896a672e",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{admin_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/admin/tickets",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"tickets"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Ticket Detail",
					"id": "49143173-dcee2acc-600b-4c2e-be4d-c2b2ff145d96",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{admin_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/admin/tickets/:id",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"tickets",
								":id"
							],
							"variable": [
								{
									"key": "id",
									"value": "1"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Update Ticket Status",
					"id": "49143173-4d26d840-290c-4544-a8b6-78f62051e5f4",
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{admin_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"status\": \"in_progress\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/admin/tickets/:id/status",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"tickets",
								":id",
								"status"
							],
							"variable": [
								{
									"key": "id",
									"value": "1"
								}
							]
						}
					},
					"response": []
				}
			],
			"id": "49143173-fd8182b5-ccd2-4738-a3fe-c08c8bc9eb88"
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8080"
		},
		{
			"key": "token",
			"value": ""
		},
		{
			"key": "admin_token",
			"value": ""
		}
	]
}